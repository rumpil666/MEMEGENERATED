(()=>{"use strict";var e=document.querySelector(".popup"),t=document.querySelector(".input"),n=document.querySelector(".download"),o=document.querySelectorAll(".input__rgb"),r=document.querySelector(".green"),u=document.querySelector(".red"),c=document.querySelector(".blue"),a=document.querySelector(".popup__input"),i=document.querySelector(".popup__form"),d=document.querySelector(".canvas");d.width=1200,d.height=600;var l,v,p,s=d.getContext("2d"),f=d.getBoundingClientRect(),m=[],g=50,h=-1;function w(t){"Escape"===t.key&&(h=-1,e.classList.remove("popup--open"))}function y(){e.classList.add("popup--open"),document.addEventListener("keydown",w),a.focus()}function L(){h=-1,e.classList.remove("popup--open"),document.removeEventListener("keydown",w)}function x(){s.drawImage(l,0,0,d.width,d.height),s.fillStyle="rgb(".concat(u.value,", ").concat(r.value,", ").concat(c.value,")"),s.font="".concat(g,'px "Segoe UI"');for(var e=0;e<m.length;e++){var t=m[e];s.fillText(t.text,t.x,t.y)}for(var n=0;n<m.length;n++){var o=m[n];o.width=s.measureText(o.text).width,o.height=g}}function E(e,t,n){var o=m[n];return e>=o.x&&e<=o.x+o.width&&t>=o.y-o.height&&t<=o.y}function S(e){e.target.value>255&&(e.target.value=255,x()),e.target.value<0&&(e.target.value="",x()),e.target.value.match(/[^0-9]/)&&(e.target.value="",x()),x()}d.addEventListener("mousedown",(function(e){v=e.clientX-f.left,p=e.clientY-f.top;for(var t=0;t<m.length;t++)E(v,p,t)&&(h=t)})),d.addEventListener("mousemove",(function(e){if(!(h<0)){var t=e.clientX-f.left,n=e.clientY-f.top,o=t-v,r=n-p;v=t,p=n;var u=m[h];u.x+=o,u.y+=r,x()}})),d.addEventListener("mouseup",(function(){document.querySelector(".popup--open")||(h=-1)})),d.addEventListener("mouseout",(function(){document.querySelector(".popup--open")||(h=-1)})),d.addEventListener("dblclick",(function(e){if(l){var t=e.clientX-f.left,n=e.clientY-f.top;(0===m.length||h<0)&&(a.value="",y());for(var o=0;o<m.length;o++)E(t,n,o)&&(h=o,a.value=m[o].text,y())}})),t.addEventListener("change",(function(e){var t=(window.webkitURL||window.URL).createObjectURL(e.target.files[0]),n=new Image;n.src=t,l=n,n.onload=function(){s.drawImage(n,0,0,d.width,d.height)}})),document.addEventListener("keydown",(function(e){"ArrowUp"===e.key&&(g+=1,x()),"ArrowDown"===e.key&&(g-=1,x())})),i.addEventListener("submit",(function(e){e.preventDefault(),h<0?(m.push({text:a.value,x:f.width/2-s.measureText(a.value).width,y:f.height/2}),L(),x()):(m[h].text=a.value,L(),x())})),o.forEach((function(e){return e.addEventListener("input",S)})),n.addEventListener("click",(function(){var e=document.createElement("a");e.download="download.png",e.href=d.toDataURL(),e.click(),e.delete}))})();